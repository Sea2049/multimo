# æ–­ç‚¹ç»­ä¼ åŠŸèƒ½å¿«é€Ÿå‚è€ƒ

## ğŸ¯ ä¸€å¥è¯æ€»ç»“
**æ–­ç‚¹ç»­ä¼ åŠŸèƒ½å·²å®Œå…¨å®ç°**ï¼Œé€šè¿‡è‡ªåŠ¨é©¾é©¶ç®¡ç†å™¨æ”¯æŒæœåŠ¡é‡å¯åä»æ–­ç‚¹ç»§ç»­æ‰§è¡Œæ¨¡æ‹Ÿä»»åŠ¡ã€‚

---

## ğŸ“Œ å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼

```bash
# 1. é…ç½®è‡ªåŠ¨é©¾é©¶
POST /api/simulation/auto-pilot/config
{
  "simulation_id": "sim_xxxx",
  "mode": "auto"
}

# 2. å¯åŠ¨è‡ªåŠ¨é©¾é©¶ï¼ˆè‡ªåŠ¨æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰
POST /api/simulation/auto-pilot/start
{
  "simulation_id": "sim_xxxx",
  "force": false
}

# 3. æŸ¥è¯¢çŠ¶æ€
POST /api/simulation/auto-pilot/status
{
  "simulation_id": "sim_xxxx"
}

# æœåŠ¡é‡å¯åï¼Œå†æ¬¡è°ƒç”¨ start ä¼šè‡ªåŠ¨ä»æ–­ç‚¹ç»§ç»­ï¼
```

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### ä»€ä¹ˆæ˜¯æ–­ç‚¹ç»­ä¼ ï¼Ÿ
- **å¯åŠ¨æ¨¡æ‹Ÿ** â†’ æ‰§è¡Œåˆ°ä¸€åŠ â†’ **æœåŠ¡é‡å¯** â†’ **è‡ªåŠ¨ä»ä¸­æ–­ç‚¹ç»§ç»­**

### å·¥ä½œåŸç†
1. æ¯ä¸ªæ­¥éª¤å®Œæˆåï¼Œä¿å­˜ `last_completed_step` åˆ°æ–‡ä»¶
2. æœåŠ¡é‡å¯åï¼ŒåŠ è½½çŠ¶æ€æ–‡ä»¶
3. ä» `last_completed_step` ç»§ç»­æ‰§è¡Œ

### 4ä¸ªæ‰§è¡Œæ­¥éª¤
```
PREPARING    â†’ å‡†å¤‡ç¯å¢ƒï¼ˆè¯»å–å®ä½“ã€ç”ŸæˆProfileã€ç”Ÿæˆé…ç½®ï¼‰
STARTING     â†’ å¯åŠ¨æ¨¡æ‹Ÿï¼ˆæ£€æµ‹è¿›åº¦ï¼Œæ”¯æŒæ¢å¤ï¼‰
MONITORING   â†’ ç›‘æ§è¿è¡Œï¼ˆå®æ—¶æ›´æ–°è¿›åº¦ï¼‰
GENERATING_REPORT â†’ ç”ŸæˆæŠ¥å‘Š
```

---

## ğŸ“Š API é€ŸæŸ¥è¡¨

| åŠŸèƒ½ | æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|------|
| é…ç½®æ¨¡å¼ | POST | `/api/simulation/auto-pilot/config` | è®¾ç½® auto/manual æ¨¡å¼ |
| å¯åŠ¨ | POST | `/api/simulation/auto-pilot/start` | å¯åŠ¨è‡ªåŠ¨é©¾é©¶ï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰ |
| æš‚åœ | POST | `/api/simulation/auto-pilot/pause` | æš‚åœæ‰§è¡Œ |
| æ¢å¤ | POST | `/api/simulation/auto-pilot/resume` | æ¢å¤æ‰§è¡Œ |
| åœæ­¢ | POST | `/api/simulation/auto-pilot/stop` | åœæ­¢æ‰§è¡Œ |
| æŸ¥è¯¢çŠ¶æ€ | POST | `/api/simulation/auto-pilot/status` | è·å–å½“å‰çŠ¶æ€ |
| é‡ç½® | POST | `/api/simulation/auto-pilot/reset` | é‡ç½®çŠ¶æ€ï¼ˆä»å¤´å¼€å§‹ï¼‰ |

---

## ğŸ® å¸¸è§æ“ä½œ

### æ“ä½œ1ï¼šå¯åŠ¨æ¨¡æ‹Ÿï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰
```json
POST /api/simulation/auto-pilot/start
{
  "simulation_id": "sim_xxxx",
  "force": false
}
```
- `force=false`: å¦‚æœæœ‰è¿›åº¦ï¼Œä»æ–­ç‚¹ç»§ç»­
- `force=true`: é‡ç½®æ‰€æœ‰çŠ¶æ€ï¼Œä»å¤´å¼€å§‹

### æ“ä½œ2ï¼šæŸ¥çœ‹è¿›åº¦
```json
POST /api/simulation/auto-pilot/status
{
  "simulation_id": "sim_xxxx"
}
```
è¿”å›ï¼š
```json
{
  "status": "active",
  "current_step": "monitoring",
  "step_progress": 45,
  "step_message": "æ¨¡æ‹Ÿè¿è¡Œä¸­: 50/120 è½®",
  "progress_detail": {
    "current_round": 50,
    "total_rounds": 120
  }
}
```

### æ“ä½œ3ï¼šæš‚åœå’Œæ¢å¤
```json
// æš‚åœ
POST /api/simulation/auto-pilot/pause
{"simulation_id": "sim_xxxx"}

// æ¢å¤
POST /api/simulation/auto-pilot/resume
{"simulation_id": "sim_xxxx"}
```

### æ“ä½œ4ï¼šæœåŠ¡é‡å¯åç»§ç»­
```json
// æœåŠ¡é‡å¯åï¼Œå†æ¬¡è°ƒç”¨ start
POST /api/simulation/auto-pilot/start
{
  "simulation_id": "sim_xxxx",
  "force": false
}
// ä¼šè‡ªåŠ¨ä» last_completed_step ç»§ç»­æ‰§è¡Œï¼
```

---

## ğŸ“ æ–‡ä»¶ä½ç½®

### çŠ¶æ€æ–‡ä»¶
```
backend/data/simulations/auto_pilot/
â””â”€â”€ {simulation_id}_autopilot.json
```

### æ ¸å¿ƒä»£ç 
```
backend/app/services/auto_pilot_manager.py    # è‡ªåŠ¨é©¾é©¶ç®¡ç†å™¨
backend/app/api/simulation.py                 # API æ¥å£ (ç¬¬2897-3364è¡Œ)
```

---

## ğŸ” çŠ¶æ€å­—æ®µè¯´æ˜

```json
{
  "simulation_id": "sim_xxxx",           // æ¨¡æ‹ŸID
  "mode": "auto",                        // æ¨¡å¼ï¼šauto/manual
  "status": "active",                    // çŠ¶æ€ï¼šinactive/active/paused/completed/failed
  "current_step": "monitoring",          // å½“å‰æ­¥éª¤
  "step_progress": 45,                   // æ­¥éª¤è¿›åº¦ (0-100)
  "step_message": "æ¨¡æ‹Ÿè¿è¡Œä¸­: 50/120 è½®", // æ­¥éª¤æ¶ˆæ¯
  "last_completed_step": "starting",     // æœ€åå®Œæˆçš„æ­¥éª¤ï¼ˆç”¨äºæ¢å¤ï¼‰
  "error": null,                         // é”™è¯¯ä¿¡æ¯
  "retry_count": 0                       // é‡è¯•æ¬¡æ•°
}
```

---

## âš¡ å…³é”®ç‰¹æ€§

### âœ… è‡ªåŠ¨æ¢å¤
- æœåŠ¡é‡å¯åè‡ªåŠ¨ä»æ–­ç‚¹ç»§ç»­
- æ— éœ€æ‰‹åŠ¨å¹²é¢„

### âœ… çŠ¶æ€æŒä¹…åŒ–
- å®Œæ•´çš„çŠ¶æ€ä¿å­˜åˆ° JSON æ–‡ä»¶
- æ”¯æŒé•¿æœŸè¿è¡Œï¼ˆæœ€å¤š72å°æ—¶ï¼‰

### âœ… çµæ´»æ§åˆ¶
- æ”¯æŒæš‚åœã€æ¢å¤ã€åœæ­¢ã€é‡ç½®
- æ”¯æŒå¼ºåˆ¶é‡æ–°å¼€å§‹

### âœ… å®æ—¶ç›‘æ§
- è¯¦ç»†çš„è¿›åº¦ä¿¡æ¯
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ç¡®è®¤æ–­ç‚¹ç»­ä¼ æ˜¯å¦å·¥ä½œï¼Ÿ
**A**: 
1. å¯åŠ¨æ¨¡æ‹Ÿåï¼ŒæŸ¥çœ‹çŠ¶æ€æ–‡ä»¶ï¼š
   ```bash
   cat backend/data/simulations/auto_pilot/sim_xxxx_autopilot.json
   ```
2. è®°ä¸‹ `last_completed_step` çš„å€¼
3. é‡å¯æœåŠ¡åï¼Œå†æ¬¡æŸ¥çœ‹è¯¥æ–‡ä»¶
4. å¦‚æœ `last_completed_step` å€¼å¢åŠ ï¼Œè¯´æ˜æ–­ç‚¹ç»­ä¼ å·¥ä½œæ­£å¸¸

### Q2: å¦‚ä½•å¼ºåˆ¶é‡æ–°å¼€å§‹ï¼Ÿ
**A**: 
```json
POST /api/simulation/auto-pilot/start
{
  "simulation_id": "sim_xxxx",
  "force": true
}
```

### Q3: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ï¼Ÿ
**A**: 
```bash
grep "auto_pilot" backend/logs/*.log
```

### Q4: æ‰§è¡Œå¤±è´¥åå¦‚ä½•æ¢å¤ï¼Ÿ
**A**: 
```json
// 1. é‡ç½®çŠ¶æ€
POST /api/simulation/auto-pilot/reset
{"simulation_id": "sim_xxxx"}

// 2. é‡æ–°å¯åŠ¨
POST /api/simulation/auto-pilot/start
{"simulation_id": "sim_xxxx", "force": true}
```

---

## ğŸ“ˆ æ‰§è¡Œæµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯åŠ¨è‡ªåŠ¨é©¾é©¶ (force=false)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ åŠ è½½çŠ¶æ€æ–‡ä»¶   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ£€æŸ¥ last_completed   â”‚
        â”‚ _step æ˜¯å¦ä¸º IDLE     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ æ˜¯å¦ä¸º IDLEï¼Ÿ         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
       æ˜¯                      å¦
        â”‚                       â”‚
        â–¼                       â–¼
   ä» PREPARING          ä» last_completed_step
   å¼€å§‹æ‰§è¡Œ              ç»§ç»­æ‰§è¡Œ
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ æ‰§è¡Œ 4 ä¸ªæ­¥éª¤    â”‚
            â”‚ 1. PREPARING    â”‚
            â”‚ 2. STARTING     â”‚
            â”‚ 3. MONITORING   â”‚
            â”‚ 4. REPORT       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ å®Œæˆ (COMPLETED) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒå»ºè®®
```json
// æ€»æ˜¯ä½¿ç”¨ force=falseï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
POST /api/simulation/auto-pilot/start
{
  "simulation_id": "sim_xxxx",
  "force": false
}
```

### 2. å®šæœŸæ£€æŸ¥çŠ¶æ€
```bash
# æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡çŠ¶æ€
while true; do
  curl -X POST http://localhost:5001/api/simulation/auto-pilot/status \
    -H "Content-Type: application/json" \
    -d '{"simulation_id": "sim_xxxx"}'
  sleep 300
done
```

### 3. ç›‘æ§æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f backend/logs/multimo.log | grep auto_pilot
```

### 4. é”™è¯¯å¤„ç†
```bash
# å¦‚æœå‡ºç°é”™è¯¯ï¼Œå…ˆæŸ¥çœ‹é”™è¯¯ä¿¡æ¯
curl -X POST http://localhost:5001/api/simulation/auto-pilot/status \
  -H "Content-Type: application/json" \
  -d '{"simulation_id": "sim_xxxx"}' | grep error

# ç„¶åé‡ç½®å¹¶é‡æ–°å¯åŠ¨
curl -X POST http://localhost:5001/api/simulation/auto-pilot/reset \
  -H "Content-Type: application/json" \
  -d '{"simulation_id": "sim_xxxx"}'

curl -X POST http://localhost:5001/api/simulation/auto-pilot/start \
  -H "Content-Type: application/json" \
  -d '{"simulation_id": "sim_xxxx", "force": true}'
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡ä»¶
- è¯¦ç»†åˆ†æ: `æ–­ç‚¹ç»­ä¼ åŠŸèƒ½åˆ†æ.md`
- ç®¡ç†å™¨ä»£ç : `backend/app/services/auto_pilot_manager.py`
- API ä»£ç : `backend/app/api/simulation.py` (ç¬¬2897-3364è¡Œ)

### æŸ¥çœ‹æºä»£ç 
- [AutoPilotManager](file:///e:/trae/multimo/backend/app/services/auto_pilot_manager.py)
- [API æ¥å£](file:///e:/trae/multimo/backend/app/api/simulation.py#L2897-L3364)

