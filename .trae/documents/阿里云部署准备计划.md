# 阿里云部署实施计划

根据您的架构需求（用户 → Cloudflare → 阿里云 ECS），我制定了以下部署计划。

## 1. 配置文件准备

### 1.1 创建 `docker-compose.yml` (根目录)
用于编排前后端服务：
- **backend**: Python 后端服务，挂载数据卷以持久化存储（uploads, logs, db）。
- **frontend**: Nginx + Vue 前端服务，反向代理 API 请求到 backend。

### 1.2 创建 `frontend/nginx.conf`
配置 Nginx：
- 托管 Vue 静态文件。
- 将 `/api` 请求转发给后端容器 (`http://backend:5001`)。
- 配置 SPA 路由支持（防止刷新 404）。

### 1.3 创建生产环境配置模板 `.env.production`
包含必要的环境变量：
- `LLM_API_KEY`, `LLM_BASE_URL` 等。
- `DEBUG=False`
- `CORS_ORIGINS` (配置为您的域名)

## 2. 部署脚本与文档

### 2.1 创建 `deploy/aliyun/README.md`
详细的操作指南：
- **ECS 初始化**：安装 Docker, Git。
- **Cloudflare 配置**：DNS 解析，SSL/TLS 设置（建议 Full 模式）。
- **阿里云安全组**：开放 80/443 端口。
- **OSS 配置**（可选）：说明如何挂载 OSS 或后续迁移静态资源。

### 2.2 创建 `deploy.sh`
一键部署脚本：
- 拉取最新代码。
- 构建并启动 Docker 容器。
- 清理旧镜像。

## 3. 执行步骤

1.  **生成配置文件**：我将为您创建上述所有配置文件。
2.  **本地验证**：您可以先在本地运行 `docker-compose up` 验证镜像构建。
3.  **服务器部署**：您只需将代码上传到 ECS 并运行 `deploy.sh`。

确认后，我将开始创建这些文件。