# 错误处理改进实施计划

## 📋 任务概述
提供更友好的错误提示和恢复建议，改进前后端的错误处理机制，提升用户体验。

**预计时间：** 3-4 小时

---

## 🎯 实施步骤

### 第一阶段：后端错误处理增强（1.5小时）

#### 1.1 创建统一错误响应格式
**文件：** `backend/app/api/__init__.py`

- 扩展 `get_error_response()` 函数，添加错误代码和恢复建议
- 新增错误代码枚举类（ErrorCode）
- 新增错误恢复建议映射（ErrorRecovery）

**新增响应格式：**
```json
{
    "success": false,
    "status_code": 400,
    "error_code": "INVALID_INPUT",
    "message": "错误消息",
    "recovery_suggestion": "请检查输入参数",
    "data": null
}
```

#### 1.2 完善异常日志记录
**文件：** `backend/app/__init__.py`

- 增强 `register_error_handlers()` 函数
- 添加详细的错误上下文记录（请求路径、参数、用户信息等）
- 区分不同类型的错误（网络、超时、业务逻辑等）

#### 1.3 应用新错误格式
**涉及文件：** `backend/app/api/graph.py`, `simulation.py`, `report.py`
- 使用新的错误响应格式
- 添加具体的错误代码和恢复建议

---

### 第二阶段：前端错误处理增强（1.5小时）

#### 2.1 创建错误提示组件
**新建文件：** `frontend/src/components/ErrorAlert.vue`

**功能特性：**
- 支持不同错误类型的样式（error、warning、info）
- 显示错误消息和恢复建议
- 支持重试按钮
- 自动消失或手动关闭

#### 2.2 改进 API 拦截器
**文件：** `frontend/src/api/index.js`

**错误分类处理：**
- **网络错误：** "网络连接失败，请检查网络设置"
- **超时错误：** "请求超时，请稍后重试或刷新页面"
- **服务器错误（500）：** "服务器错误，请联系管理员"
- **业务逻辑错误（400）：** 显示后端返回的具体错误消息

#### 2.3 更新视图组件错误处理
**涉及文件：**
- `frontend/src/components/Step1GraphBuild.vue`
- `frontend/src/components/Step2EnvSetup.vue`
- `frontend/src/components/Step3Simulation.vue`
- `frontend/src/components/Step4Report.vue`
- `frontend/src/components/Step5Interaction.vue`
- `frontend/src/views/SimulationView.vue`
- `frontend/src/views/ReportView.vue`

**改进内容：**
- 移除 `alert()` 调用，使用 ErrorAlert 组件
- 统一错误处理逻辑
- 添加错误重试机制

---

### 第三阶段：错误重试机制（0.5小时）

#### 3.1 前端重试机制增强
**文件：** `frontend/src/api/index.js`

- 优化现有的 `requestWithRetry()` 函数
- 添加可配置的重试策略（次数、延迟、指数退避）
- 为特定错误类型启用自动重试

---

### 第四阶段：测试与文档更新（0.5小时）

#### 4.1 测试错误场景
- 测试网络断开场景
- 测试请求超时场景
- 测试服务器错误场景

#### 4.2 更新框架文档
**文件：** `FRAMEWORK.md`
- 添加新的错误处理机制说明
- 更新代码目录，添加 ErrorAlert.vue

---

## 📁 涉及文件清单

### 后端（修改）
1. `backend/app/api/__init__.py` - 统一错误响应格式
2. `backend/app/__init__.py` - 完善错误处理器
3. `backend/app/api/graph.py` - 应用新错误格式
4. `backend/app/api/simulation.py` - 应用新错误格式
5. `backend/app/api/report.py` - 应用新错误格式

### 前端（新建）
1. `frontend/src/components/ErrorAlert.vue` - 错误提示组件

### 前端（修改）
1. `frontend/src/api/index.js` - 改进拦截器
2. `frontend/src/components/*.vue` - 更新错误处理

### 文档（修改）
1. `FRAMEWORK.md` - 更新框架文档

---

## 🔍 安全检查清单

- ✅ 错误消息不暴露敏感信息
- ✅ 错误日志记录完整但不包含敏感数据
- ✅ 前端错误提示用户友好且不泄露技术细节
- ✅ 重试机制有合理的上限